<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with VizSeasonalGams • VizSeasonalGams</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with VizSeasonalGams">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">VizSeasonalGams</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting started with VizSeasonalGams</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cbedwards-dfw/VizSeasonalGams/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with VizSeasonalGams</h1>
                        <h4 data-toc-skip class="author">Collin
Edwards</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cbedwards-dfw/VizSeasonalGams/blob/main/vignettes/getting-started.Rmd" class="external-link"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="d-none name"><code>getting-started.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/cbedwards-dfw/VizSeasonalGams" class="external-link">"VizSeasonalGams"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"mgcv"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: nlme</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'nlme'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     collapse</span></span></code></pre>
<pre><code><span><span class="co">## This is mgcv 1.9-3. For overview type 'help("mgcv-package")'.</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>rmarkdown.html_vignette.check_title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                      fig.width <span class="op">=</span> <span class="fl">8</span>, </span>
<span>                      fig.height <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                      out.width <span class="op">=</span> <span class="st">"80%"</span>,   <span class="co"># HTML output width</span></span>
<span>                      dpi <span class="op">=</span> <span class="fl">300</span>, </span>
<span>                      fig.retina <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                      dev <span class="op">=</span> <span class="st">"png"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>VizSeasonalGams</code> is a package to make understanding
complex generalized additive models (GAMs) fit with the R package
<code>mgcv</code> easier, producing plots of model predictions for all
relevant combinations of factorial predictors.</p>
<p>This package was originally motivated by modeling seasonal patterns
of angler catch rates of different classes of fish in different years,
sometimes incorporating other categorical predictors (gear type,
region). When the fitted model allowed seasonal patterns to vary based
on these categorical predictors, it became unwieldy to look at how model
predictions varied across different combinations of predictor values.
This was compounded by wanting to compare model predictions between
models with different structures.</p>
<p><code>VizSeasonalGams</code> automates the process of visualizing
model predictions from fitted <code>mgcv</code> models, allowing us to
focus on understanding the model rather than writing visualization
code.</p>
<p>If you are looking at this package and you are not already familiar
with the <a href="https://gavinsimpson.github.io/gratia/" class="external-link">gratia</a>
package, I highly recommend taking a look at it as well. gratia is a
useful and robust toolkit for working with <code>mgcv</code> models, and
covers things like model diagnostics, visualizing partial effects plots,
and estimating derivatives. It’s fantastic! I developed
<code>VizSeasonalGams</code> to fulfil a role that gratia does not
currently: visualizing model predictions.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>In this vignette I will use examples of fish counts varying across
day of year in ways that depend on other categorical predictors (year,
fish class). However, despite the name, <code>VizSeasonalGams</code> is
not limited to gams of seasonal patterns. Any <code>mgcv</code> model
with at least one smooth across a continuous variable will work – for
example, temperature response curves, or dose-response curves.</p>
<p>To facilitate exploring this package, <code>VizSeasonalGams</code>
includes two simulation functions. <code>simulate_data</code> generates
reasonable fish count data that could be fit with a gam model:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">##     doy  year mark_stage yearfac fish_count</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   208  <span style="text-decoration: underline;">2</span>021 Jack       2021             0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>   208  <span style="text-decoration: underline;">2</span>021 AD Adult   2021             2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>   208  <span style="text-decoration: underline;">2</span>021 UM Adult   2021             1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>   208  <span style="text-decoration: underline;">2</span>021 Jack       2021             0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>   208  <span style="text-decoration: underline;">2</span>021 AD Adult   2021             0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>   208  <span style="text-decoration: underline;">2</span>021 UM Adult   2021             1</span></span></code></pre>
<p>Here “doy” is day of year, <code>yearfac</code> is year (as a
factor), and <code>mark_stage</code> is a fish classification (“Jack” =
smaller fish, “AD Adult” = marked adult, “UM adult” = unmarked
adult).</p>
<p><code><a href="../reference/simulate_gam.html">simulate_gam()</a></code> uses simulate_data(), fits an mgcv model
of the form
<code>fish_count ~ mark_stage + s(doy, by = mark_stage, k = 20) + yearfac</code>,
and returns the fitted model. For your own explorations, it is
sufficient to simply use the output of <code><a href="../reference/simulate_gam.html">simulate_gam()</a></code> to
test the visualization functions of <code>VizSeasonalGams</code>. For
clarity we will fit the model explicitly here.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">fish_count</span> <span class="op">~</span> <span class="va">mark_stage</span> <span class="op">+</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">doy</span>, by <span class="op">=</span> <span class="va">mark_stage</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="va">yearfac</span>,</span>
<span>            method <span class="op">=</span> <span class="st">"REML"</span>,</span>
<span>            family <span class="op">=</span> <span class="st">"nb"</span>,</span>
<span>            data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>This model has a smooth across day of year which varies by fish
stage, and total catch is also affected by year.</p>
<p>The workhorse function of <code>VizSeasonalGams</code> is
<code><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels()</a></code>, which makes a tibble of
categorical predictors and model prediction plots. Each combination of
categorical predictors represented in the original data is given its own
row, and the <code>.$plot</code> column of each row shows “panels” of
the model predictions as a function of the key variable being smoothed
across (defaults to “doy”, but can be specified with the optional
<code>plot_by</code> argument). For example:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panels</span> <span class="op">=</span> <span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panels</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">##   mark_stage yearfac .plot     </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Jack       2021    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AD Adult   2021    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> UM Adult   2021    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Jack       2022    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> AD Adult   2022    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> UM Adult   2022    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> Jack       2023    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> AD Adult   2023    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> UM Adult   2023    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span></code></pre>
<p>We can access each of the plots directly, like so:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panels</span><span class="op">$</span><span class="va">.plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-5-1.png" width="80%"></p>
<p>In models that contain additional continuous variable, the median
value across the original dataset is used when creating these
panels.</p>
<p>The tibble of panels (or a subset thereof) can be presented as a
joint plot using <code><a href="../reference/wrap_panels.html">wrap_panels()</a></code> and
<code><a href="../reference/grid_panels.html">grid_panels()</a></code>. These are intended to fill similar roles
to<code>facet_wrap</code> and <code>facet_grid</code>.</p>
<p><code><a href="../reference/wrap_panels.html">wrap_panels()</a></code> is the simplest, as it simply combines
each of the panels in order:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wrap_panels.html">wrap_panels</a></span><span class="op">(</span><span class="va">panels</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-6-1.png" width="80%"></p>
<p><code><a href="../reference/grid_panels.html">grid_panels()</a></code> organizes the panels based on two
categorical predictors that are represented in the panels tibble:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/grid_panels.html">grid_panels</a></span><span class="op">(</span><span class="va">panels</span>, column_var <span class="op">=</span> <span class="st">"yearfac"</span>, row_var <span class="op">=</span> <span class="st">"mark_stage"</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-7-1.png" width="80%"></p>
<p>Both of these functions can work on subsetted versions of the panel
tibble. For example, imagine we are only interested in the smooths of
2021:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panels</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">yearfac</span> <span class="op">==</span> <span class="st">"2021"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/wrap_panels.html">wrap_panels</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-8-1.png" width="80%"></p>
<p>Or perhaps we want to take a grid view, but our jack results look a
bit funky so we want to remove them:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panels</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mark_stage</span> <span class="op">!=</span> <span class="st">"Jack"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/grid_panels.html">grid_panels</a></span><span class="op">(</span>column_var <span class="op">=</span> <span class="st">"yearfac"</span>, row_var <span class="op">=</span> <span class="st">"mark_stage"</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-9-1.png" width="80%"></p>
</div>
<div class="section level2">
<h2 id="generalizing-plots">Generalizing plots<a class="anchor" aria-label="anchor" href="#generalizing-plots"></a>
</h2>
<p>The default behavior of <code>plot_seasonal_gam_panels</code> is
based on my own most common use case: looking at seasonal smooths across
a day of year variable labeled “doy”. For looking at smooths across
other variable names and types of data, we can change the values of
arguments <code>plot_by</code> and <code>labeler_x</code>.
<code>plot_by</code> can take the name of a continuous variable used in
the model, and will use that to determine the x axis of each panel.
<code>labeler_x</code> can take any function, and uses that to label the
x axis as per
<code>ggplot::scale_x_continuous(labels = labeler_x)</code>. By default
it uses the <code><a href="../reference/doy_2md.html">doy_2md()</a></code> function defined in
<code>VizSeasonalGams</code>, which translates numeric day of year to
month-day string. Setting <code>labeler_x</code> to <code>NULL</code>
will instead present x labels in their original values.</p>
<p>Depending on the scale of the data we’re trying to plot, we may also
need to change the argument <code>across_increment</code>. This term
defines the x resolution of our predictions plots and defaults to 1;
this is an appropriate resolution for daily samples (e.g., one
prediction per day), but not so appropriate when our x variable has a
much smaller range.</p>
<p>As an example, here we visualize one of the simpler models fit in the
<a href="https://peerj.com/articles/6876/" class="external-link">excellent Pedersen et
al. 2019</a>. We use the built-in CO2 data. Here we’re smoothing across
log(concentration). <strong>Note that presently plot_seasonal_gam_panels
does not properly handle predictors that are functions.</strong> So
instead of using <code>log(conc)</code> directly in our model, we need
to create a new variable <code>log_conc</code> that is log
concentration, and then use that in the model.</p>
<p>We make three changes to the default behavior of
<code>plot_seasonal_gam_panels</code>: change <code>plot_by</code> to
reflect our x variable of interest, change <code>labeler_x</code> to
<code>NULL</code> because our x axis is no longer a date, and set
<code>across_increment</code> to 0.01 to reflect our smaller range of x
axis values.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## recode plant from ordered to unordered</span></span>
<span><span class="va">CO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">CO2</span>, Plant_uo<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Plant</span>, ordered<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>log_conc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span>,</span>
<span>         log_uptake <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">uptake</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## fit model</span></span>
<span><span class="va">model_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">log_uptake</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">log_conc</span>, k<span class="op">=</span><span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"tp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">Plant_uo</span>, k<span class="op">=</span><span class="fl">12</span>, bs<span class="op">=</span><span class="st">"fs"</span>, m<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                 data<span class="op">=</span><span class="va">CO2</span>, method<span class="op">=</span><span class="st">"REML"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_co2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span>plot_by <span class="op">=</span> <span class="st">"log_conc"</span>,</span>
<span>                           labeler_x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                           across_increment <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/wrap_panels.html">wrap_panels</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: Plant_uo.</span></span></code></pre>
<p><img src="getting-started_files/figure-html/unnamed-chunk-10-1.png" width="80%"></p>
</div>
<div class="section level2">
<h2 id="customizing-plots">Customizing plots<a class="anchor" aria-label="anchor" href="#customizing-plots"></a>
</h2>
<div class="section level3">
<h3 id="modifying-panels">Modifying panels<a class="anchor" aria-label="anchor" href="#modifying-panels"></a>
</h3>
<p>By default <code><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels()</a></code> includes a data
coverage plot at the bottom of the panel. This plot takes the role that
rugplots typicaly do in <code>mgcv</code> and <code>gratia</code>. As
compared to rugplots, this approach takes up more realestate, but gives
more information when multiple records can have the same x value (as is
commonly the case when using day-of-year; multiple surveys may occur on
the same day). This behavior can be turned off with
<code>plot_coverage = FALSE</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">=</span> <span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span>plot_coverage <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span><span class="op">$</span><span class="va">.plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-11-1.png" width="80%"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wrap_panels.html">wrap_panels</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-11-2.png" width="80%"></p>
<p>(Presently there is no implementation of rugplots, nor coverage plots
along the X axis; reach out to the developer if these are features you
would value.)</p>
<p>Sometimes it can be useful to include multiple prediction curves in a
single panel. The optional argument <code>color_by</code> in
<code><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels()</a></code> can take the name of a
categorical variable in the data in order to do just that.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span>color_by <span class="op">=</span> <span class="st">"yearfac"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/wrap_panels.html">wrap_panels</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-12-1.png" width="80%"></p>
<p>When including multiple curves in each panel, the confidence
envelopes can make interpretation challenging. Use
<code>include_cis = FALSE</code> to turn off envelope plotting:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span>color_by <span class="op">=</span> <span class="st">"yearfac"</span>, include_cis <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/wrap_panels.html">wrap_panels</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-13-1.png" width="80%"></p>
<p>Note that including a <code>color_by</code> variable removes a column
from the resulting panels tibble; this means that column is no longer
available for <code><a href="../reference/grid_panels.html">grid_panels()</a></code> calls.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">##   mark_stage yearfac .plot     </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Jack       2021    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AD Adult   2021    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> UM Adult   2021    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Jack       2022    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> AD Adult   2022    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> UM Adult   2022    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span> Jack       2023    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span> AD Adult   2023    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">9</span> UM Adult   2023    <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span>color_by <span class="op">=</span> <span class="st">"yearfac"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">##   mark_stage .plot     </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Jack       <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> AD Adult   <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> UM Adult   <span style="color: #949494;">&lt;patchwrk&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="shared-scales">Shared scales<a class="anchor" aria-label="anchor" href="#shared-scales"></a>
</h3>
<p>By default, each panel is plotted on its own scale. This ensures that
each set of model predictions is easily interpretable, but can make the
visualizations misleading when comparing between panels.</p>
<p>For example, our model is constructed such that the smooths across
day of year cannot differ between years, but we include a fixed effect
of years. This means that looking along rows in our grid_panels(), it is
easy to mistakenly assume predicted fish count is identical in each
year.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/grid_panels.html">grid_panels</a></span><span class="op">(</span>column_var <span class="op">=</span> <span class="st">"yearfac"</span>, row_var <span class="op">=</span> <span class="st">"mark_stage"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<p><img src="getting-started_files/figure-html/unnamed-chunk-15-1.png" width="80%"></p>
<p><code><a href="../reference/grid_panels.html">grid_panels()</a></code> has optional arguments to control shared
scales: <code>scales_x</code> (controls sharing of x axis limits),
<code>scales_y</code> (controls sharing of y axis limits of primary
plot), and <code>scales_y_coverage</code> (controls sharing of y axis of
coverage plots; ignored if coverage plots are not included). Each of
these arguments defaults to <code>"free"</code> (each panel varies
freely), but can take any of the following arguments:</p>
<ul>
<li>
<code>"fixed_column"</code>: panels in the same column share limits
in the specified dimension.</li>
<li>
<code>"fixed_row"</code>: panels in the same row will share the
limits in the specified dimension</li>
<li>
<code>"fixed_combination"</code>: panels in the same row x column
combination will share limits in the specified dimension. Relevant when
there are more than one panel for each column x row combination (see
below),</li>
<li>
<code>"fixed_all"</code>: all panels share limits in the specified
dimension.</li>
</ul>
<p>So to ensure that the fish counts within each row are comparable
across columns, we should use `scales_y = “fixed_row”</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/grid_panels.html">grid_panels</a></span><span class="op">(</span>column_var <span class="op">=</span> <span class="st">"yearfac"</span>, row_var <span class="op">=</span> <span class="st">"mark_stage"</span>,</span>
<span>              scales_y <span class="op">=</span> <span class="st">"fixed_row"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<p><img src="getting-started_files/figure-html/unnamed-chunk-16-1.png" width="80%"></p>
<p>These arguments make it possible to emphasize differences between
panels or details within panels, as needed. For example, when presenting
to people more focused on the practical outcomes, it may be most
appropriate to use “fixed_all”:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/grid_panels.html">grid_panels</a></span><span class="op">(</span>column_var <span class="op">=</span> <span class="st">"yearfac"</span>, row_var <span class="op">=</span> <span class="st">"mark_stage"</span>,</span>
<span>              scales_y <span class="op">=</span> <span class="st">"fixed_all"</span>,</span>
<span>              scales_x <span class="op">=</span> <span class="st">"fixed_all"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<p><img src="getting-started_files/figure-html/unnamed-chunk-17-1.png" width="80%"></p>
<p>The default behavior is <code>"free"</code> for all scales but unless
you have a specific need it is probably best to start with
<code>scales_x = "fixed_all"</code>.</p>
<p>Presently there is no equivalent implementation for
<code>scales_*</code> arguments in <code>wrap_grids()</code> (there are
not natural choices for grouping panels to share scales), but I will be
adding this with <code>"free"</code> and <code>"fixed_all"</code>
options.</p>
</div>
</div>
<div class="section level2">
<h2 id="sub-panels-and-augmented-panel-tibbles">Sub-panels and augmented panel tibbles<a class="anchor" aria-label="anchor" href="#sub-panels-and-augmented-panel-tibbles"></a>
</h2>
<p>First, a fun feature of <code>grid_panels</code> is that it handles
cases in which multiple rows of the panel tibble match the criterion of
a given row and column. As an example, we will create a dataset that has
a bit of new data: Jacks with a different treatment in 2022 and 2023. To
make it interesting, we will allow the smooth across day of year to vary
by tratment as well as mark_stage.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mark_stage</span> <span class="op">==</span> <span class="st">"Jack"</span>,</span>
<span>         <span class="va">yearfac</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2022"</span>, <span class="st">"2023"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_joint</span> <span class="op">=</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">fish_count</span> <span class="op">~</span> </span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">te</a></span><span class="op">(</span><span class="va">doy</span>, <span class="va">mark_stage</span>, <span class="va">treatment</span>, bs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tp"</span>, <span class="st">"fs"</span>, <span class="st">"fs"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>               <span class="va">yearfac</span>,</span>
<span>             method <span class="op">=</span> <span class="st">"REML"</span>,</span>
<span>             family <span class="op">=</span> <span class="st">"nb"</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_joint</span><span class="op">)</span></span></code></pre></div>
<p>Now if we use <code><a href="../reference/grid_panels.html">grid_panels()</a></code> by year and mark_stage, we
have multiple prediction panels for several of our jack treatments.
<code>grid_panels</code> has no problem handling that:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/grid_panels.html">grid_panels</a></span><span class="op">(</span>column_var <span class="op">=</span> <span class="st">"yearfac"</span>, row_var <span class="op">=</span> <span class="st">"mark_stage"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: yearfac, mark_stage, and treatment.</span></span></code></pre>
<p><img src="getting-started_files/figure-html/unnamed-chunk-19-1.png" width="80%"></p>
<p>Second, because wrap_panels and grid_panels work on a panel of
tibbles rather than directly from a fitted model, we can combine tibbles
from different models. The most obvious use is to compare how choices of
model structure or fitting options affect the resulting predictions. For
example, how different are our results if we use a Gaussian error
distribution instead of a negative binomial? (This helps illustrate why
it’s valuable to specify a count distribution for count data)</p>
<p>We’ll keep making our grid by “yeafac” and “mark_stage”, so we’ll
have to subpanels, one for each model. To make results between the
models easily comparable, we’ll set
<code>scales_y = "fixed_combination"</code>. This will ensure that we
can reasonably compare between the model subpanels, while ensuring that
differences in fish counts between mark_stage or yearfac don’t make some
sets of model predictions unreadable.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_nb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">fish_count</span> <span class="op">~</span> <span class="va">mark_stage</span> <span class="op">+</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">doy</span>, by <span class="op">=</span> <span class="va">mark_stage</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>                 <span class="va">yearfac</span>,</span>
<span>               method <span class="op">=</span> <span class="st">"REML"</span>,</span>
<span>               family <span class="op">=</span> <span class="st">"nb"</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_gaus</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">fish_count</span> <span class="op">~</span> <span class="va">mark_stage</span> <span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">doy</span>, by <span class="op">=</span> <span class="va">mark_stage</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>                   <span class="va">yearfac</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"REML"</span>,</span>
<span>                 family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">panels_nb</span> <span class="op">=</span> <span class="va">model_nb</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"negative binomial"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panels_gaus</span> <span class="op">=</span> <span class="va">model_gaus</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span>
<span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">panels_joint</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">panels_nb</span>, <span class="va">panels_gaus</span><span class="op">)</span></span>
<span></span>
<span><span class="va">panels_joint</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/grid_panels.html">grid_panels</a></span><span class="op">(</span>column_var <span class="op">=</span> <span class="st">"yearfac"</span>, row_var <span class="op">=</span> <span class="st">"mark_stage"</span>,</span>
<span>              scales_x <span class="op">=</span> <span class="st">"fixed_all"</span>, scales_y <span class="op">=</span> <span class="st">"fixed_combination"</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-20-1.png" width="90%"></p>
<p>Here we can see how the negative binomial correctly represents
heteroskedasticity, and (depending on your simulation values) we may see
the gaussian predicting negative fish counts.</p>
<p>Combining panels tibbles allows us to quickly compare the
consequences of choosing different model structures, model fitting
settings, or even the effects of modifying the data (e.g. removing
outliers, reducing sample sizes, etc). In fact, this use is so prevalent
in my own workflow that I have added the ability for
plot_seasonal_gam_panels() to handle this on its own: if you give a
named list of models rather than a single model,
<code><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels()</a></code> will create a panel tibble for
each model, add a <code>$model</code> column with value equal to the
model name, and then return the joint panel tibble. (If you want the
model column named something else, like if you are actually comparing
models fit to different datasets and prefer the label be “data”, you can
modify this with the optional <code>model_label</code> argument.)</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_seasonal_gam_panels.html">plot_seasonal_gam_panels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"gaussian"</span> <span class="op">=</span> <span class="va">model_gaus</span>,</span>
<span>                              <span class="st">"negative binomial"</span> <span class="op">=</span> <span class="va">model_nb</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/grid_panels.html">grid_panels</a></span><span class="op">(</span>column_var <span class="op">=</span> <span class="st">"yearfac"</span>, row_var <span class="op">=</span> <span class="st">"mark_stage"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<pre><code><span><span class="co">## → `color_by` not provided. Defaulting to no color.</span></span></code></pre>
<pre><code><span><span class="co">## → Options for `color_by`: mark_stage and yearfac.</span></span></code></pre>
<p><img src="getting-started_files/figure-html/unnamed-chunk-21-1.png" width="90%"></p>
</div>
<div class="section level2">
<h2 id="fiddly-graphics-tweaking">Fiddly graphics tweaking<a class="anchor" aria-label="anchor" href="#fiddly-graphics-tweaking"></a>
</h2>
<p><code>VizSeasonalGams</code> is not intended to make
publication-ready plots, but it is intended to produce visualizations
that can be shared with collaborators, stakeholders, and other
interested parties. With this in mind there are several optional
arguments to change aspects of the visualization:</p>
<div class="section level3">
<h3 id="plot_seasonal_gam_panels">
<code>plot_seasonal_gam_panels()</code><a class="anchor" aria-label="anchor" href="#plot_seasonal_gam_panels"></a>
</h3>
<ul>
<li>quant_trimming: restricts prediction range based on quantiles of the
available <code>plot_by</code> data for each combination of categorical
variables. Defaults to 0.01, increase to restrict prediction curves to
regions that are better supported by the data.</li>
<li>breaks_x: approximate number of breaks used when plotting the x
axis. Defaults to 3.</li>
</ul>
</div>
<div class="section level3">
<h3 id="wrap_panels-and-grid_panels">
<code>wrap_panels()</code> and <code>grid_panels()</code><a class="anchor" aria-label="anchor" href="#wrap_panels-and-grid_panels"></a>
</h3>
<ul>
<li>title_size: changes the font size of the panel titles. Useful when
working with model that has many categorical predictors – changing the
title size can help make sure all factors are readable. Defaults to
8.</li>
</ul>
</div>
<div class="section level3">
<h3 id="wrap_panels-only">
<code>wrap_panels()</code> only<a class="anchor" aria-label="anchor" href="#wrap_panels-only"></a>
</h3>
<ul>
<li>
<code>ncol</code>, <code>nrow</code>: determines the number of
columns or rows to use when combining panels into a single figure;
analogous to <code>ncol</code> and <code>nrow</code> of
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="grid_panels-only">
<code>grid_panels()</code> only<a class="anchor" aria-label="anchor" href="#grid_panels-only"></a>
</h3>
<ul>
<li>
<code>panel_titles</code>: by default, grid_panel() only includes
panel title information that isn’t represented by column and row labels.
However, it can be useful to include all variable values represented by
a panel (e.g., for screenshotting subsets of a grid). Defaults to
<code>FALSE</code>, set to <code>TRUE</code> for complete panel
titles.</li>
<li>
<code>col_title_ratio</code>, <code>row_title_ratio</code>: handling
the whitespace in patchwork plots is a bit imperfect; two arguments
allow you to tweak the relative amount of space taken up by the primary
content and the column and row titles. Defaults to 30. Reduce to
increase space taken up by column and row titles.</li>
<li>
<code>font_size</code>: font size of column and row headers.
Defaults to 18</li>
<li>
<code>new_y_label</code>, <code>new_x_label</code>: allows
relabeling of the X and Y axes of panels to improve readability.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Pedersen EJ, Miller DL, Simpson GL, Ross N. 2019. Hierarchical
generalized additive models in ecology: an introduction with mgcv. PeerJ
7:e6876 <a href="https://doi.org/10.7717/peerj.6876" class="external-link uri">https://doi.org/10.7717/peerj.6876</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Collin Edwards.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
